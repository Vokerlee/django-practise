{% extends "base_page.html" %}

{% block content %}

<div class="section">
    <h1 class="center-align">Технические индикаторы</h1>

    <!-- Display Messages -->
    {% if messages %}
        <div class="row">
            {% for message in messages %}
                <div class="col s12">
                    <div class="card-panel {{ message.tags }}">
                        <span class="black-text">{{ message }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Add Indicator Button -->
    <div class="row">
        <div class="col s12 center-align">
            <a href="#add-indicator-modal" class="modal-trigger btn waves-effect waves-light">
                Добавить индикатор
                <i class="material-icons right">add</i>
            </a>
        </div>
    </div>

    <!-- List of Indicators -->
    <div class="row">
        {% for indicator in indicators %}
            <div class="col s12 m6 l4">
                <div class="card blue-grey darken-1">
                    <div class="card-content white-text">
                        <span class="card-title">{{ indicator.name }}</span>
                        <p><strong>Описание:</strong> {{ indicator.description }}</p>
                        <p><strong>Формула:</strong> {{ indicator.formula }}</p>
                        <p><strong>Рекомендации:</strong> {{ indicator.recommendation }}</p>
                    </div>
                    <div class="card-action">
                        <a href="#modal-{{ indicator.id }}" class="modal-trigger btn-small waves-effect waves-light blue">
                            Подробнее
                            <i class="material-icons right">info</i>
                        </a>

                        <!-- Delete Form -->
                        <form method="POST" action="{% url 'delete_indicator' indicator.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-small red waves-effect waves-light" onclick="return confirm('Вы уверены, что хотите удалить индикатор {{ indicator.name }}?');">
                                Удалить
                                <i class="material-icons right">delete</i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Modal for Indicator Details -->
            <div id="modal-{{ indicator.id }}" class="modal">
                <div class="modal-content">
                    <h4>{{ indicator.name }}</h4>
                    <p><strong>Описание:</strong> {{ indicator.description }}</p>
                    <p><strong>Формула:</strong> {{ indicator.formula }}</p>
                    <p><strong>Рекомендации по использованию:</strong> {{ indicator.recommendation }}</p>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close btn-flat">Закрыть</a>
                </div>
            </div>
        {% endfor %}

        {% if not indicators %}
            <div class="col s12">
                <p class="center-align">Пока нет индикаторов. Добавьте первый!</p>
            </div>
        {% endif %}
    </div>

    <!-- Modal for Adding New Indicator -->
    <div id="add-indicator-modal" class="modal">
        <div class="modal-content">
            <h4>Добавить новый индикатор</h4>
            <form method="POST" id="add-indicator-form">
                {% csrf_token %}
                <div class="row">
                    <div class="input-field col s12">
                        <input id="name" name="name" type="text" class="validate" required>
                        <label for="name">Название</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <textarea id="description" name="description" class="materialize-textarea" required></textarea>
                        <label for="description">Описание</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <textarea id="formula" name="formula" class="materialize-textarea" required></textarea>
                        <label for="formula">Формула</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <textarea id="recommendation" name="recommendation" class="materialize-textarea" required></textarea>
                        <label for="recommendation">Рекомендации по использованию</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close btn-flat">Отмена</a>
                    <button type="submit" class="btn waves-effect waves-light">
                        Добавить
                        <i class="material-icons right">send</i>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
